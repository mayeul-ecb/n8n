(function(s,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(s=typeof globalThis<"u"?globalThis:s||self,e(s.V3InfiniteLoading={},s.Vue))})(this,function(s,e){"use strict";const C="",f=(t,i)=>{const n=t.__vccOpts||t;for(const[o,c]of i)n[o]=c;return n},g={},y=t=>(e.pushScopeId("data-v-259be2b2"),t=t(),e.popScopeId(),t),h={class:"container"},b=[y(()=>e.createElementVNode("div",{class:"spinner"},null,-1))];function E(t,i){return e.openBlock(),e.createElementBlock("div",h,b)}const S=f(g,[["render",E],["__scopeId","data-v-259be2b2"],["__file","/home/oumoussa/side-projects/infinite/src/components/Spinner.vue"]]),x=t=>({loading(){t.value="loading"},loaded(){t.value="loaded"},complete(){t.value="complete"},error(){t.value="error"}}),v=(t,i,n)=>()=>{const o=n.parentEl||document.documentElement;n.prevHeight=o.scrollHeight,i.loading(),t("infinite",i)},I=(t,i)=>{const n=t.getBoundingClientRect();if(!i)return n.top>=0&&n.bottom<=window.innerHeight;const o=i.getBoundingClientRect();return n.top>=o.top&&n.bottom<=o.bottom},u=t=>{t.parentEl=document.querySelector(t.target)||null;let i=`0px 0px ${t.distance}px 0px`;t.top&&(i=`${t.distance}px 0px 0px 0px`);const n=new IntersectionObserver(o=>{o[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:i});return n.observe(t.infiniteLoading.value),n},O="",k={class:"state-error"},N=f({__name:"InfiniteLoading",props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstload:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(t,{emit:i}){const n=t;let o=null;const c=e.ref(null),d=e.ref("ready"),{top:_,firstload:V,target:B,distance:q}=n,{identifier:m}=e.toRefs(n),r={infiniteLoading:c,target:B,top:_,firstload:V,distance:q,prevHeight:0,parentEl:null};r.emit=v(i,x(d),r);const L=()=>e.watch(d,async l=>{const a=r.parentEl||document.documentElement;await e.nextTick(),l=="loaded"&&_&&(a.scrollTop=a.scrollHeight-r.prevHeight),l=="loaded"&&I(c.value,r.parentEl)&&r.emit(),l=="complete"&&o.disconnect()}),w=()=>e.watch(m,()=>{d.value="ready",o.disconnect(),o=u(r)});return e.onMounted(()=>{o=u(r),L(),m&&w()}),e.onUnmounted(()=>{o.disconnect()}),(l,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteLoading",ref:c},[d.value=="loading"?e.renderSlot(l.$slots,"spinner",{key:0},()=>[e.createVNode(S)],!0):e.createCommentVNode("v-if",!0),d.value=="complete"?e.renderSlot(l.$slots,"complete",{key:1},()=>{var p;return[e.createElementVNode("span",null,e.toDisplayString(((p=t.slots)==null?void 0:p.complete)||"No more results!"),1)]},!0):e.createCommentVNode("v-if",!0),d.value=="error"?e.renderSlot(l.$slots,"error",{key:2,retry:r.emit},()=>{var p;return[e.createElementVNode("span",k,[e.createElementVNode("span",null,e.toDisplayString(((p=t.slots)==null?void 0:p.error)||"Oops something went wrong!"),1),e.createElementVNode("button",{class:"retry",onClick:a[0]||(a[0]=(...$)=>r.emit&&r.emit(...$))}," retry ")])]},!0):e.createCommentVNode("v-if",!0)],512))}},[["__scopeId","data-v-9d82030b"],["__file","/home/oumoussa/side-projects/infinite/src/components/InfiniteLoading.vue"]]);s.default=N,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
