{"version":3,"file":"errorhandler.js","sources":["../../src/errorhandler.ts"],"sourcesContent":["import { captureException } from '@sentry/core';\nimport type { ViewModel, Vue, VueOptions } from './types';\nimport { formatComponentName, generateComponentTrace } from './vendor/components';\n\ntype UnknownFunc = (...args: unknown[]) => void;\n\nexport const attachErrorHandler = (app: Vue, options: VueOptions): void => {\n  const { errorHandler: originalErrorHandler } = app.config;\n\n  app.config.errorHandler = (error: Error, vm: ViewModel, lifecycleHook: string): void => {\n    const componentName = formatComponentName(vm, false);\n    const trace = vm ? generateComponentTrace(vm) : '';\n    const metadata: Record<string, unknown> = {\n      componentName,\n      lifecycleHook,\n      trace,\n    };\n\n    if (options.attachProps && vm) {\n      // Vue2 - $options.propsData\n      // Vue3 - $props\n      if (vm.$options?.propsData) {\n        metadata.propsData = vm.$options.propsData;\n      } else if (vm.$props) {\n        metadata.propsData = vm.$props;\n      }\n    }\n\n    // Capture exception in the next event loop, to make sure that all breadcrumbs are recorded in time.\n    setTimeout(() => {\n      captureException(error, {\n        captureContext: { contexts: { vue: metadata } },\n        mechanism: { handled: !!originalErrorHandler, type: 'vue' },\n      });\n    });\n\n    // Check if the current `app.config.errorHandler` is explicitly set by the user before calling it.\n    if (typeof originalErrorHandler === 'function' && app.config.errorHandler) {\n      (originalErrorHandler as UnknownFunc).call(app, error, vm, lifecycleHook);\n    } else {\n      throw error;\n    }\n  };\n};\n"],"names":["formatComponentName","generateComponentTrace","captureException"],"mappings":";;;;;MAMa,kBAAA,GAAqB,CAAC,GAAG,EAAO,OAAO,KAAuB;AAC3E,EAAE,MAAM,EAAE,YAAY,EAAE,sBAAqB,GAAI,GAAG,CAAC,MAAM;;AAE3D,EAAE,GAAG,CAAC,MAAM,CAAC,YAAA,GAAe,CAAC,KAAK,EAAS,EAAE,EAAa,aAAa,KAAmB;AAC1F,IAAI,MAAM,gBAAgBA,8BAAmB,CAAC,EAAE,EAAE,KAAK,CAAC;AACxD,IAAI,MAAM,KAAA,GAAQ,EAAA,GAAKC,iCAAsB,CAAC,EAAE,CAAA,GAAI,EAAE;AACtD,IAAI,MAAM,QAAQ,GAA4B;AAC9C,MAAM,aAAa;AACnB,MAAM,aAAa;AACnB,MAAM,KAAK;AACX,KAAK;;AAEL,IAAI,IAAI,OAAO,CAAC,WAAA,IAAe,EAAE,EAAE;AACnC;AACA;AACA,MAAM,IAAI,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE;AAClC,QAAQ,QAAQ,CAAC,SAAA,GAAY,EAAE,CAAC,QAAQ,CAAC,SAAS;AAClD,aAAa,IAAI,EAAE,CAAC,MAAM,EAAE;AAC5B,QAAQ,QAAQ,CAAC,SAAA,GAAY,EAAE,CAAC,MAAM;AACtC;AACA;;AAEA;AACA,IAAI,UAAU,CAAC,MAAM;AACrB,MAAMC,qBAAgB,CAAC,KAAK,EAAE;AAC9B,QAAQ,cAAc,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,EAAE,QAAA,EAAS,EAAG;AACvD,QAAQ,SAAS,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC,oBAAoB,EAAE,IAAI,EAAE,KAAA,EAAO;AACnE,OAAO,CAAC;AACR,KAAK,CAAC;;AAEN;AACA,IAAI,IAAI,OAAO,oBAAA,KAAyB,UAAA,IAAc,GAAG,CAAC,MAAM,CAAC,YAAY,EAAE;AAC/E,MAAM,CAAC,oBAAA,GAAqC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,aAAa,CAAC;AAC/E,WAAW;AACX,MAAM,MAAM,KAAK;AACjB;AACA,GAAG;AACH;;;;"}